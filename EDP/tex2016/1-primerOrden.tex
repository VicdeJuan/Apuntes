% -*- root: ../EDP2016.tex -*-
\chapter{Ecuaciones de primer orden}

	\section{Planteamiento del problema}
	\label{sec:PlanteamientoPrimerOrden}

	\begin{figure}[thbp]
	\centering
	\inputtikz{CarrilCoches}
	\caption{Un modelo simplificado de cómo se mueven los coches en un carril.}
	\label{fig:CochesCarril}
	\end{figure}

	Vamos a empezar con un modelo sencillo. Observemos el fenómeno del embotellamiento fantasma, el cual tiene una ecuación bastante sencilla. Veamos cómo se generan esos atascos y cómo se disipan.

	Estudiaremos una función $u(x,t)$ que nos dará la densidad de coches en un punto $x$ en un momento $t$.

	Primero, observamos un modelo muy simple en el que solo hay un carril y los coches fluyen solo en una dirección, como en la \fref{fig:CochesCarril}. La variación en el número de coches de un intervalo será:
	\[ \od{}{t} \int^{x+h}_{x} u(s,t) \dif s = \int^{x+h}_{x} u_t(s,t) \dif s \]

	Esto equivale a al número de coches que entran por $x$ menos los que salen por $x + h$. Es decir, tenemos un flujo $q(u, x, t)$. Si suponemos que nos fijamos en un instante lo suficientemente pequeño en un tramo pequeño podemos asumir que depende solo de $u$. En ese caso, si $q > 0$ el flujo sería hacia la derecha.
	\( q(u(x,t)) - q(u(x+h,t)) = -\left[ q(u(x+h,t)) -  q(u(x,t)) \right] \eqexpl{Barrow} -\int^{x+h}_{x} [q(u)]_{x}
	\label{eq:BaseFlujo}\)

	Por lo tanto, tendremos sistemas del tipo:
	\begin{equation}
	\left\{
	\begin{array}{rl}
	u_t + [q(u)]_{x} =&\!\!\! 0 \\
	u(x, 0) =&\!\!\! F(x) \quad \quad \text{dato}
	\end{array}
	\right. \label{eq:ModeloAtasco}
	\end{equation}

	Ahora debemos probar distintas funciones $q$ y tratar de resolver el sistema. Eso será precisamente lo que haremos a lo largo de este capítulo.

	\section{Modelos básicos: flujo proporcional a la densidad}
	\label{sec:ModeloBasicoFlujoProporcional}

		\begin{figure}[hbtp]
		\centering
		\inputtikz{CochesModeloLineal}
		\caption{Con un modelo de flujo proporcional a la densidad, los coches simplemente se desplazan manteniendo la misma densidad.}
		\label{fig:CochesModeloLineal}
		\end{figure}

		Tomando $q(u) = cu$ en \eqref{eq:ModeloAtasco}, nuestro sistema se convierte en
		\begin{equation}
		\left\{
		\begin{array}{l}
		u_t + cu_x = 0 \\
		u(x,0) = F(x)
		\end{array}
		\right. \label{eq:ModeloBasico}
		\end{equation}

		Esta ecuación dice que el flujo es proporcional a la densidad. Implica que los coches se mueven con velocidad constante, a más velocidad más flujo y viceversa. Si en el instante inicial tenemos una función de la densidad respecto de las zonas del tramo, según pasa el tiempo la densidad se irá desplazando hacia la derecha manteniendo la misma forma (\fref{fig:CochesModeloLineal}).

		Podemos comprobar esta idea intuitiva. Si lo que hacemos es ``desplazar'' la densidad, entonces lo que tenemos es que $u(x,t) = F(x-ct)$. Vamos a comprobar que la ecuación \eqref{eq:ModeloBasico} sigue cumpliéndose con esta definición. Primero derivamos \[ u_x(x,t) = F'(x-ct) \qquad u_t(x,t) = F'(x-ct) · (-c) \] y luego sustituyendo nos queda directamente: \begin{align*}
			u_t + c·u_x &= 0 \\
			-c·F'(x-ct) + c·F'(x-ct) &= 0
		\end{align*}

		\subsection{Representación gráfica: Curvas características}

			Para entender mejor el problema lo que haremos será dibujarlo con un método que nos valdrá para muchos otros problemas. La idea es dibujar los ``conjuntos de nivel'' de la solución, y para eso usaremos el concepto \concept[Curvas\IS características]{curvas características}, curvas a lo lago de las cuales el dato (en este caso, la densidad) se mantiene constante.\footnote{Porque el problema es homogéneo.}

			En este problema, el dato inicial de la densidad se propaga con velocidad $ct$, luego lo que tendremos son rectas $x - ct = k$.

			Si lo hiciésemos sustituyendo en las ecuaciones nos saldría lo mismo: si $u(x,t)$ es constante, también lo es $F(x-ct)$ y esto en general sólo ocurrirá cuando $x - ct = k$. En cualquiera de los dos casos, el dibujo sería algo parecido al de la \fref{fig:ConjNivelCochesSimple}.

			\begin{figure}
			\centering
			\inputtikz{ConjNivelCochesSimple}
			\caption{Las rectas diagonales son las curvas características, y en cada región se mantiene la misma densidad que había en el primer momento $t = 0$.}
			\label{fig:ConjNivelCochesSimple}
			\end{figure}



	\subsection{Modelo con curvas dato alternativas}
		\label{sec:CurvaDatoRara}

		Imaginemos un río con una velocidad constante, en el que a partir de un punto realizamos un vertido. El río tiene velocidad $v$ y en ${x=0}$ realizaremos una contaminación $\beta(t)$. En ${t=0}$ consideraremos que está limpio. Usamos el mismo modelo que antes, pero con la peculiaridad de que la curva dato la estamos dando de otra forma: antes dábamos el dato inicial como lo que ocurría cuando ${t = 0}$. Aquí, damos una curva dato para $t > 0$ y $x > 0$.

		En este caso, las ecuaciones que tenemos son las siguientes:
		\begin{align*}
		u_t + vu_x &= 0 \\
		u(x,0) &= 0 \qquad x>0 \\
		u(0,t) &= \beta(t)\quad t>0
		\end{align*}

		Resolvemos el problema igual que en el caso anterior: buscamos los conjuntos de nivel, que nos volverán a salir rectas.

		\textbf{Buscamos $x(t)$ tal que $u(x(t),t)$ sea constante}

		Derivando en t la ecuación anterior obtenemos: $u_x x' + u_t = 0$ que junto con la ecuación $u_t + v u_x = 0$ nos da que $x' = v \Rightarrow x = x_0 + vt $.

		Las características saldrían \(x-vt = \text{Cte}(=x_0) \label{eq:rio_vcte}\)

		\begin{figure}[hbtp]
			\centering
			\inputtikz{ContaminacionRio}
			\caption{La zona roja indica contaminación, y la zona verde implica río limpio. Ambas están divididas por la recta $x - vt = 0$, que indica cuándo una zona del río se contamina. La curva dato está dada en las zonas marcadas en azul y naranja.}
			\label{fig:ContaminacionRio}
		\end{figure}

		Esas son nuestras rectas conjuntos de nivel, que en este caso indicarían el frente de la contaminación, el límite a partir del cual el río sigue limpio.

		$$u(x,t) =
			\begin{cases}
				0                      & (x-vt) > 0 \\
				\beta(t - \frac{x}{v}) & (x-vt) < 0
			\end{cases}
		$$

		El valor de $u(x,t)$ cuando $x-vt < 0$, se obtiene utilizando la \fref{eq:rio_vcte} y tomando el punto de corte de la recta $x-c \cdot t=k$ que pasa por $(0,t^*)$:

		$$
		\begin{rcases}
			0 - vt^{*} = k \\
			x - vt = k
		\end{rcases}
		 \Rightarrow x-vt = -vt^{*} \iff t^* = \frac{x-vt}{-v} = t - \frac{x}{v}$$

		Por lo que
		$$u(x,t) = \beta(t^*) = \beta(t - \frac{x}{v}), \quad \text{ cuando } x - vt < 0$$

		De esto obtenemos una función de $x$ en función del tiempo que nos permite saber cuándo una parte del río se contamina.

	\subsection{Modelo con descomposición biológica}

	De momento, hemos considerado sólo modelos en los que el flujo que entraba en un segmento era igual al que salía por otro lado. Sin embargo, ¿qué ocurre cuando además tenemos algún tipo de descomposición externa? Veámoslo primero con un ejemplo, siguiendo el modelo anterior del río.

		Supongamos que existe descomposición biológica, de tal forma que en cada punto del río hay bacterias que ``quitan'' una parte de la contaminación proporcional (coeficiente γ) al flujo. En ese caso, el sistema de ecuaciones es \[
		\begin{cases}
		u_t + vu_x = -\gamma u \\
		u(x,0) = \text{Cte} \\
		u(0,t) = \beta
		\end{cases} \]

		Para resolverlo, podemos hacer un cambio de variable. Para ello, comenzamos multiplicando por $e^{\gamma t}$:
		$$u_t + \gamma u + vu_x = 0$$
		$$e^{\gamma t} u_t + e^{\gamma t} \gamma u + e^{ \gamma t} v u_x = 0 $$

		lo que es lo mismo
		\[ (e^{\gamma t}u)_t + v (e^{\gamma t} u)_x = 0 \]

		Y definimos la función $W$:
		$$W = e^{\gamma t}u$$


		Hay que comprobar cuál es el efecto del término de descomposición biológica ($-\gamma u$), y calcular $W(x,0)$ y $ W(0,t)$. Esto queda como ejercicio para el lector.


	\subsection{Modelo general para flujo lineal}
	\label{sec:ModeloGeneral}

		Vamos a tratar de unir todo lo que tenemos hasta ahora. En todos los casos (el del atasco y los dos del río) nuestras ecuaciones han sido de la forma \[
		\begin{cases}
		u_t + vu_x = f(x,t) \\
		u(x,0) = F(x) \\
		\end{cases} \]

		Cuando $f \not\equiv 0$ lo que nos ocurría es que la solución no es constante a lo largo de las características, aunque seguirán estando ahí y las podremos usar para hacernos una idea del problema.

		¿Cómo solucionamos el problema? Hay dos posibilidades.

		\subsubsection{Cambio de variable}

			La primera idea es hacer un cambio de variables para funcionar en una única variable, $z = x-vt$, que hace más sencillo observar la variación temporal. Sustituyendo la $x$, tenemos que \begin{align*}
			x &= z + vt\\
			W(z,t) &= u(z+vt, t)
			\end{align*}

			Para reconstruir $W$ (y por tanto la solución) lo que vamos a hacer es fijarnos en que la solución en un punto depende del dato inicial en ese punto y luego de cómo ha evolucionado a lo largo del tiempo. Es decir, \[ W(z,t) = W(z,0) + \int_{0}^t W_t(z,τ) \dif τ \]

			No parece que hayamos avanzado mucho, pero si calculamos $W_t$ \[
				W_t(z,t) = u_x(z + vt, t)v + u_t(z+vt, t) = f(z + vt, t)
			\] ahora podemos sustituir y esperar que nos salga algo interesante. De hecho, lo hace:
			\[ W(z,t) = W(z,0) + \int^{t}_{0} f(z+v\tau, \tau)\dif\tau \]

			Porque si ahora deshacemos el cambio de variable $z = x -vt$ nos queda que \begin{align}
			W(z,t) &= W(z,0) + \int^{t}_{0} f(z+v\tau, \tau)\dif\tau \nonumber \\
			u(z + vt, t) &= u(z,0) + \int^{t}_{0} f(z+v\tau, \tau) \dif \tau \nonumber \\
			u(x,t) &= u(x-vt,0)+ \int^{t}_{0} f(x-v(t-\tau),\tau) \dif \tau \label{eq:ModeloCombinado}
			\end{align} donde $u(x-vt,0) = F(x-vt)$.

			Esto es un milagro ya que tiene una fórmula explícita, que es poco común en EDOs y EDPs. Es posible encontrar algo mejor.

		\subsubsection{Principio de Duhamel}
		\label{sec:PrincipioDuhamel}

			Una segunda solución es aplicar el \concept{Principio\IS de Duhamel}, que se basa un poco en la misma idea que antes: que el valor de $u$ en un punto depende de cómo ha ido evolucionando a lo largo del tiempo, y a ese resultado se le puede sumar el dato inicial (la suma de soluciones es solución).

			Tendremos entonces que \[ u = \varphi + \psi \] lo que nos deja dos sistemas:

			\begin{minipage}{.5\linewidth}
				\[
				\begin{cases*}
					\varphi_t + v\varphi_x = 0\\
					\varphi(x,0) = F(x)
				\end{cases*}
				\]
			\end{minipage}
			\begin{minipage}{.5\linewidth}
				\[
				\begin{cases*}
					\psi_t + v\psi_x = f(x,t) \\
					\psi(x,0) = 0
				\end{cases*}
				\]
			\end{minipage}

			La comprobación de que ambos sistemas son equivalentes es trivial y se deja como ejercicio para el lector.

			El primer sistema ya lo hemos resuelto en la \fref{sec:ModeloBasicoFlujoProporcional}, y la solución era ${φ(x,t) = F(x - vt)}$. Para el segundo, aplicaremos la idea que hemos visto antes, que es ver que el valor de la solución en un punto dependerá de la aportación externa que ha habido en él a lo largo del tiempo. Lo malo es que no podemos simplemente integrar $f$, que sería la idea evidente.

			Lo que ocurre es que hay una función, que llamaremos ξ y que, por así decirlo, ``transporta'' las aportaciones externas. Dependerá de $x$ y de $t$, el momento en el espacio y tiempo en el que queremos saber la aportación externa, pero también de otro parámetro $s$, que será el ``momento'' en el que aparece la aportación externa que estamos considerando. Por ejemplo, cuando $t = s$ la aportación externa viene dada por $f(x,t)$, luego ha de ser $ξ(x,s; s) = f(x,s)$.

			Esta función tiene que cumplir la ecuación anterior $ξ_t + v ξ_x = 0$, luego el sistema que tenemos es \( \begin{cases}
			ξ_t + vξ_x = 0 \\
			ξ(x,s;s) = f(x,s)
			\end{cases} \label{eq:SistemaDuhamel} \)

			Como decíamos, la función ξ transporta las aportaciones externas, luego \( ξ(x,t; s) = f(x_0, s) \label{eq:DuhamelExpr1} \) donde $x_0$ es el punto donde ``surgió'' esta aportación externa, que dependerá del punto $x$ que consideremos y también del tiempo que ha pasado ($s-t$).

			Por suerte para nosotros, el sistema \eqref{eq:SistemaDuhamel} sabemos resolverlo: en él, las soluciones son constantes a lo largo de las rectas características. Y como $$ξ(x,t;s) = f(x_0, s) = ξ(x_0,s;s)$$ tenemos que $(x,t)$ y $(x_0, s)$ tienen que estar en la misma recta. Así podemos sacar $x_0$:
			\[
			\begin{rcases}
				x-vt = k\\
				x_0 - vs = k
			\end{rcases}
			 \implies x-vt = x_0 - vs \implies
			x_0 = x-v(t-s) \]

			Tal y como habíamos conjeturado al principio, ese punto inicial depende del que estamos considerando y de la diferencia de tiempo $s-t$. Sustituyendo ahora en \eqref{eq:DuhamelExpr1} tenemos la solución para $ξ$:
			\[ \xi(x,t) = f(x - v(t-s), s) \]

			Tenemos la solución correspondiente de un aporte instantáneo en el punto $t$. Por lo tanto la solución será la suma de todos los aportes instantáneos:
			\[  \psi(x,t) = \int^{t}_{0} f(x-v(t-s),s) \dif s \]

			Sólo falta sumar ambas soluciones para tener la solución final, que será \(
			u(x,t) = F(x-vt) + \int_0^t f(x-v(t-s),s) \dif s \label{eq:SolDuhamel} \)

			Aunque hemos hecho un montón de suposiciones que tendremos que comprobar en algún momento.

	\section{Modelos con flujo no lineal}
	\label{sec:ModeloTraficoRealista}

		\begin{wrapfigure}{R}{0.4\textwidth}
			\centering
			\vspace{-15pt}
			\inputtikz{parabola}
			\caption{El flujo no es lineal con respecto a la densidad: si hay muchos coches, acaban parándose.}
			\label{fig:parabola}
		\end{wrapfigure}

		En los ejemplos anteriores de tráfico no hemos tenido en cuenta que la velocidad de los coches no es totalmente proporcional a la densidad. Si ésta baja mucho, los coches llegan a pararse. Hay una densidad máxima donde el tráfico quedará totalmente estancado (los coches pegados).

		Una función más realista sería una parábola (\fref{fig:parabola}). Si no hay coches no pasa ninguno, pero a partir de un punto cuantos más coches, menos rápido van, y menos pasan. El flujo vendría dado entonces por la ecuación \[
		q(u) = Au (B-u) = ABu - Au^{2} \]

		Derivando en $x$, tenemos que \[ [q(u)]_x = (AB - 2Au) u_x\] y sustituyendo esto en nuestra ecuación genérica del modelo de un atasco \eqref{eq:ModeloAtasco} nos queda el siguiente sistema: \[ \begin{cases}
		u_t + (AB - 2Au) u_x = 0 \\ u(x,0) = F(x)\end{cases}\]

		La velocidad va a ser dependiente de la densidad, así que nos saldrán características cuya pendiente dependa del valor en el tiempo inicial. Si divergen no habrá problema, pero si convergen habrá puntos donde rectas de densidad 2 (por ejemplo) cortarán con rectas de densidad 1. Esto se entiende como coches que van más rápido que se encuentran con coches que van más lentos y se ven obligados a frenar.

		Para simplificar los cálculos de este modelo asumamos que $A = B = 1$. Por lo tanto ahora estudiaremos:
		\begin{equation*}
			\left\{
			\begin{array}{l}
				u_t + (1-2u)u_{x} = 0 \\
				u(x, 0) = F(x) \quad \quad \text{dato}
			\end{array}
			\right.
		\end{equation*}

		\begin{wrapfigure}{R}{0.4\textwidth}
			\centering
			\vspace{-15pt}
			\inputtikz{rectasDivergentes}
			\vspace{-15pt}
			\caption{La solución se propaga en rectas cuya pendiente depende del valor del dato inicial $F(x)$.}
			\label{fig:rectasDivergentes}
		\end{wrapfigure}

		Obtengamos las características, las curvas a lo largo de las cuales la solución es constante ${u(x,t) = k}$, luego derivando tenemos que ${u_x x' + u_t = 0}$. Viendo el sistema anterior, tiene que ser
		\[ x' = 1 - 2u \eqexpl{$u=k$} 1 - 2k \] y por lo tanto nuestras características serán
		\( x - (1-2k)t = x_0\quad,\quad k=F(x_0)  \label{eq:caracteristicas_realistas} \)

		Nos fijamos en un punto en el instante inicial. Con el valor de ese punto calculamos la pendiente. A lo largo de las características el valor del dato se mantiene. En este caso las características no son paralelas porque la pendiente es $1-2k$, es decir, depende de $k$, como en la \fref{fig:rectasDivergentes}.

		Para ver qué casos posibles hay (por ejemplo, ¿qué pasa cuando se cortan dos rectas características?) vamos a ver algunos ejemplos según el valor de $F(x)$.

		\begin{example}[Semáforo] \label{ejm:Semaforo}
			\begin{wrapfigure}[8]{L}{0.4\textwidth}
				\centering
				\vspace{-15pt}
				\inputtikz{semaforoCerrado}
				\vspace{-15pt}
				\caption{Semáforo cerrado inicialmente.}
				\label{fig:semaforoCerrado}
			\end{wrapfigure}

			El primer caso es sencillo: un semáforo en $t = 0$ está cerrado. Su ecuación será \[
			F(x) =
			\begin{cases}
				1 & x < 0 \\
				0 & x > 0
			\end{cases}
			\]

			Y en ${t>0}$ se abre y pueden pasar los coches.\\


			En la sección izquierda, $F = 1$ luego $x - (1 - 2·1)t = x + t = k \Rightarrow x = k -t $, con $k$ constante.

			En la derecha, con cuentas análogas, $F = 0 \Rightarrow x-t = k$.

			\begin{figure}[htbp]
				\centering
				\begin{subfigure}[b]{0.49\textwidth}
				\inputtikz{caracteristicasSemaforo}
				\vspace{-8pt}
				\caption{Rectas características.}
				\end{subfigure}
				\begin{subfigure}[b]{0.49\textwidth}
				\inputtikz{semaforoT}
				\caption{Un corte de la solución para $t = T$.}
				\end{subfigure}
				\caption{En el modelo del semáforo, como no tenemos la función definida en $x = 0$ hay una zona (la zona naranja) en la que no tenemos información de lo que ocurre.}
				\label{fig:caracteristicasSemaforo}
			\end{figure}

			Vemos que las características se abren y se separan desde $x=0$ hacia afuera. Por lo tanto, las características no nos dan información en la región entre las rectas características que parten del $0$, ya que ninguna característica pasa por ese espacio.

			Esto pasa porque no está definida la función en el $0$. Si lo estuviera, podríamos intentar sacar infinitas características desde el 0 que rellenaran la zona en la que no tenemos información.

		\end{example}

		\begin{example}[Frenazo]
			\begin{wrapfigure}[10]{R}{0.4\textwidth}
				\centering
				\inputtikz{modeloAtasco}
				\vspace{-10pt}
				\caption{Dato de densidad para $t=0$ en el modelo del atasco.}
				\label{fig:modeloAtasco}
			\end{wrapfigure}

			Imaginemos ahora dos zonas, una con densidad de coches baja y otra con densidad alta (se encuentran con un atasco). La función sería  \[
			F(x) =
			\begin{cases}
				1/5 & x < 0 \\
				2/3 & x > 0
			\end{cases}
			\]

			Si dibujamos las características con \eqref{eq:caracteristicas_realistas} nos saldrá algo como lo de la \fref{fig:ondaChoque}. Ahí vemos casos en los que cuando recorremos una recta característica con valor $\frac{1}{5}$ nos encontramos con otra de valor $\frac{2}{3}$. Momento en el cual se produce el frenazo.

			Fijando $T$ podemos mirar el valor de cada $x$ trazando su correspondiente característica. Ahí es donde nos encontraremos los puntos en los que las rectas cortan. La sucesión de puntos de corte en función de $t$ es la curva que nos interesa. Se corresponde a la función que dictamina cómo se van encendiendo las luces rojas de los coches según se van parando al llegar a un atasco.

			\begin{figure}[bhp]
				\centering
				\inputtikz{ondaChoque}
				\caption{Cuando las características se cortan aparece una {\bf onda de choque}.}
				\label{fig:ondaChoque}
			\end{figure}\index{Onda!de choque}

			\obs las características terminan cuando se cortan con la onda de choque.

		\end{example}

		\subsection{Soluciones generalizadas. Ecuación de Rankine-Hugoniot}

		Intentemos resolver la curva de puntos de corte. Volvemos a la ecuación \[ u_t +m [q(u)]_x = 0 \]

		Como tiene derivadas y las funciones tienen discontinuidades, no se cumplen las hipótesis de regularidad que asumimos al partir del planteamiento integral del problema. Por tanto, debemos volver al planteamiento original, y si lo resolvemos obtendremos \concept{Soluciones\IS débiles}. Esta ecuación venía de la siguiente integral: \[
			\frac{1}{h} \int^{x+h}_{x} u_t + [q(u)]_x = 0
		\] que a su vez venía de \eqref{eq:BaseFlujo}: \[
			\od{}{t} \int^{x+h}_{x} u = q(u(x))-q(u(x+h))
		\]

		\begin{figure}[tp]
			\centering
			\inputtikz{discontinuidadAtasco}
			\caption{Las funciones que tratamos en los dos ejemplos anteriores se pueden modelar de esta forma: $C^1$ a trozos con una única discontinuidad de salto.}
			\label{fig:discontinuidadAtasco}
		\end{figure}

		La función $u$ es $C^1$ a trozos con discontinuidad de salto en $x=s(t)$. Así que llegamos al problema:	\textbf{hallar $s(t)$}, que será la ecuación de la curva de choque.

		El problema de verdad lo tenemos en los intervalos que contienen a la discontinuidad. Consideraremos entonces el intervalo $[x_1, x_2]$ como en la \fref{fig:discontinuidadAtasco}, con $x = x_1$ y $x_2 = x + h$, y veremos qué ocurre cuando $h \to 0$. La primera tarea obvia es descomponer la integra en las dos partes continuas, de tal forma que nos queda \(
		\od{}{t} \left[ \int^{s(t)}_{x_1} u(x,t) \dif x + \int^{x^2}_{s(t)} u(x,t) \dif x \right] = q(u(x_1)) - q(u(x_2)) \label{eq:DescompIntervDiscontinuidad} \)

		Aquí nos encontramos con un \textit{show-stopper}: \[ \od{}{t} \int^{s(t)}_{x_1} u(x,t) \dif x \]

		¿Cómo derivamos con respecto a $t$ una integral de una función que depende de $t$ y cuyo límite de integración también depende de $t$? Para arreglar el problema, vamos a definir una nueva función: \[ G(z,t) = \int^{z}_{x_1} u(x,t) \dif x \]

		Esta función sí podemos derivarla: \[
		G_z(z,t) = u(z,t)
		\qquad
		G_t(z,t) = \int^{z}_{x_1} u_t(x,z) \dif x
		\]

		También podemos recuperar la integral original \[ \int^{s(t)}_{x_1} u(x,t) dx = G(s(t),t) \]

		Con esto podemos derivar, no sin antes introducir una pequeña notación para denotar si nos acercamos a la discontinuidad por la derecha o por la izquierda:
		\begin{align*}
		[u(s(t),t)]^{-} &= \lim_{x \to s(t)^{-}} u(x, t) \\
		[u(s(t),t)]^{+} &= \lim_{x \to s(t)^{+}} u(x, t)
		\end{align*}

		Ahora sí, derivamos:
		\begin{align*}
		\od{}{t} \int_{x^1}^{s(t)} u(x,t) \dif x
			&= \od{G(s(t), t)}{t} = \\
			&= s'(t) · G_z(s(t), t) + G_t(z,t) = \\
			&= s'(t) · \left[u(s(t), t)\right]^{-} + \int_{x_1}^{s(t)} u_t(x,t) \dif x
		\end{align*}

		Si realizamos lo mismo con la otra integral\footnote{Ejercicio para el lector.} de \eqref{eq:DescompIntervDiscontinuidad}, llegamos a esta \textbf{conclusión}:
		\begin{multline*}
		\left(\left[u(s(t),t)\right]^{-} - \left[u(s(t),t)\right]^{+}\right)· s'(t) + \int^{s(t)}_{x_1} u_t(x,t) \dif x + \int^{x^2}_{s(t)} u_t(x,t) \dif x = \\ = q(u(x_1,t)) - q(u(x_2,t))
		\end{multline*}

		Ahora sólo falta acercar $x_1$ y $x_2$ a la discontinuidad con $x_1 \to s(t)^{-}$, y $x_2 \to s(t)^{+}$; y ver qué pasa. Las integrales se irán a cero al hacer el intervalo de integración cada vez más pequeño y el \textbf{resultado} será el siguiente:

		\[ \left[ u(s(t),t)^{-} - u(s(t),t)^{+} \right] · s'(t) = q(u(s(t),t)^{-}) - q(u(s(t),t)^{+}) \] luego
		\( s'(t) = \frac{q(u(s(t),t)^{-}) - q(u(s(t),t)^{+})}{u(s(t),t)^{-} - u(s(t),t)^{+}} \label{eq:DerivadaOndaChoque} \)

		En otras palabras, que la variación de la curva de choque $s$ (llamada \concept{Ecuación\IS de Rankine - Hugoniot}) es el cociente entre el salto en el flujo $q$ y el salto en la densidad $u$. Esta curva es precisamente la que vimos en la \fref{fig:ondaChoque}.

		\noindent Vamos a obtener la fórmula explícita utilizando los datos dados en la \fref{fig:modeloAtasco}:

		El salto en $u$ es $\frac{2}{3} - \frac{1}{5} = \frac{7}{15}$

		Y en $q$ es $\frac{2}{3} (1-\frac{2}{3}) - \frac{1}{5}(1-\frac{1}{5}) = \frac{2}{9} - \frac{4}{25} = \frac{14}{225} $

		Finalmente, sustituimos y vemos que \[
		s'(t) = \frac{\text{Salto q}}{\text{Salto u}} = \frac{\frac{14}{225}}{\frac{7}{15}} = \frac{14.15}{7.225} \equiv \alpha \quad(>0) \]

		\begin{wrapfigure}[10]{R}{0.4\textwidth}
			\centering
			\vspace{-15pt}
			\inputtikz{OndaChoqueRPM}
			\vspace{-10pt}
			\caption{Con nuestro modelo, tendremos dos regiones $R^-$, $R^+$ y una onda de choque $s(t)$ que las separa.}
			\label{fig:OndaChoqueRPM}
		\end{wrapfigure}

		Como $s(0) = 0$, la ecuación de la curva será \[
		s(t) = \alpha t \]
		por lo que la onda de choque sigue $x = s(t) = \alpha t$.

			\noindent {\bf Resumiendo} un poco, lo que hemos logrado ha sido ver esto:

			\begin{itemize}[itemsep = 1pt]
				\item $ u \in C^1 \text{ en } R^{-} \text{ y en } R^{+}. $
				\item $u$ tiene una discontinuidad de salto a lo largo de la curva $x = s(t)$.
				\item La curva satisface la condición de Rankine-Hugoniot: $s' = \frac{\text{Salto q}}{\text{Salto u}}$.
			\end{itemize}

			Vamos a usarlo para resolver el ejemplo del semáforo de la página \pageref{ejm:Semaforo}, en el que habíamos llegado a que había una zona en la que no sabíamos qué ocurría.

			\begin{example}[Semáforo - Pendiente de resolución]
				El sistema que teníamos era el siguiente:
				\[
				\begin{cases} u_t + (1-2u)u_x = 0 \\
				u(x,0) = F(x)
				\end{cases} \]

				\obs Es importante recordar que el método de las curvas características exige que el lado derecho sea 0 (problema homogéneo). Si no, hay que aplicar el principio de Duhamel, el modelo con descomposición, etc.

				\begin{figure}[hbtp]
					\centering
					\inputtikz{caracteristicasSemaforo}
					\caption{Rectas características con una región en la que no sabemos qué ocurre.}
					\label{fig:caracteristicasSemaforo2}
				\end{figure}

				Las características son las curvas $(x(t),t)$ tales que $u(x(t),t) = k$, que ya habíamos calculado y quedaban $x - (1-2k)t = x_0$, donde $x_0$ era el punto de partida y $k = F(x_0)$ el valor que se propagaba. El dibujo al que llegábamos era el de la \fref{fig:caracteristicasSemaforo2}.

				\begin{wrapfigure}{L}{0.3\textwidth}
					\centering
					\inputtikz{FEpsilon}
					\caption{Usaremos esta aproximación para saltarnos la discontinuidad}
					\label{fig:FEpsilon}
				\end{wrapfigure}

				Para calcular la región intermedia usaremos esta \textbf{idea}: Una aproximación y paso al límite. Imaginemos que $F_\epsilon$ es continua y decreciente, como en la \fref{fig:FEpsilon}. Entonces en la región intermedia:
				\[ u_\epsilon (x,t) = F_\epsilon (x_\epsilon) \equiv k_\epsilon \]

				Las características serán,  $x - (1-2k_\epsilon) t = x_\epsilon$, con $F_\epsilon(x_\epsilon) = k_\epsilon$, y lo que querremos hallar será $\lim\limits_{\epsilon \rightarrow 0} u_\epsilon(x,t)$. Para eso, despejaremos $k_ε$ que es el valor que se propaga en esa región.
				\begin{gather*}
				\frac{x - x_\epsilon}{t} = 1-2k_\epsilon \\
				k_\epsilon = \frac{1}{2} \left(1 - \frac{x-x_\epsilon}{t}\right) \convs[][\epsilon][0] \frac{1}{2} \left(1 - \frac{x}{t} \right)
				\end{gather*}

				Con esto, llegamos a una fórmula para la densidad en la región intermedia:
				\[ u(x,t) = \frac{1}{2} \left(1 - \frac{x}{t} \right) \quad \text{ si } (x,t) \text{ está en la región intermedia. } \]

				\begin{figure}[hbtp]
					\centering
					\inputtikz{SolucionTFijo}
					\caption{Solución para un $T$ fijo.}
					\label{fig:SolucionTFijo}
				\end{figure}

				Así, llegaríamos a la siguiente expresión general para un tiempo $T$ fijo
				\( u(x,T) =
				\begin{cases}
					1 & x \leq -T \\
					\frac{1}{2} \left(1 - \frac{x}{T}\right) & -T < x < T \\
					0 & x \geq T
				\end{cases} \label{eq:SolucionRarefaccion}
				\)

				A esto se le llama la \concept{Onda\IS de rarefacción}. Este resultado no depende de la aproximación que tomemos de $F_\epsilon$, solo que sea continua ya que con el paso al límite la función desaparece.
			\end{example}


	\subsection{Cambio de variables. Ecuación de Burgers}
	\label{sec:EcuacionBurgers}

		Vamos a ver otro método para la resolución de este tipo de sistemas. Partimos de la ecuación
		\[ u_t + [q(u)]_x = 0 \quad (q \in C^2) \]

		La derivada del flujo con respecto a $x$ tendrá la forma $[q(u)]_x = V(u) u_x$, de tal forma que podemos convertir nuestra ecuación en \(
		u_t + V(u)u_x = 0 \label{eq:burgers1} \) sobre la que podemos realizar el siguiente cambio de variables
		\begin{align*}
		W &= V(u) \\
		W_t &= V'(u) \cdot u_t \\
		W_x &= V'(u) \cdot u_x
		\end{align*} y ver qué ecuación cumple $W$.

		¿Qué es lo que hemos hecho? Hemos pasado a escribir la ecuación en términos de una variable que es la ``velocidad''. Esta velocidad es la velocidad de $u$, la velocidad a la que se propaga la densidad. No tenemos que entenderla como la velocidad de los coches.

		Por ejemplo, imaginemos un mapa de tráfico en el que se ve la densidad del tráfico con colores. La $W$ es la velocidad a las que esas manchas de color se desplazan, no los coches en sí. Están relacionadas pero no son lo mismo.

		Para hallar el sistema que cumple $W$, lo que hacemos es multiplicar \eqref{eq:burgers1} por $V'(u)$ a ambos lados y ver qué nos sale:
		\begin{align}
		u_t + V(u)u_x &= 0 \nonumber \\
		u_t · V'(u) + V(u) u_x · V'(u) &= 0 \nonumber \\
		W_t + W · W_x &= 0 \label{eq:Burgers}
		\end{align}

		En este caso, la ecuación es una \concept{Ecuación\IS homogénea} ya que el término independiente es $0$. Si no fuese nulo, estaríamos ante una \concept{Ecuación\IS no homogénea}, y si el término independiente fuese $\epsilon W_{xx}$ su nombre sería una \concept{Ecuación\IS viscosa}.

		\begin{example}
			\[u_t + (1-2u) u_x = 0
			\rightarrow u(x,0) =
			\begin{cases}
				1 & x < 0 \\
				0 & x > 0
			\end{cases}
			\]

			\[W_t + W W_x = 0 \text{ con } W = 1 - 2u
			\rightarrow W(x,0) =
			\begin{cases}
				-1 & x < 0 \\
				1 & x > 0
			\end{cases}
			\]

			Obviamente, los coches no se mueven hacia atrás, lo que está ocurriendo es que la señal de arranque se está propagando hacia atrás.

		\end{example}


		\subsubsection{Flujo asociado a la ecuación de Burgers}

			Expresemos ahora $q$ en función de la ecuación de Burgers.
			\begin{gather}
			W_t + WW_x = W_t + [q_B(w)]_x = 0 \nonumber \\
			q_{B} = \frac{W^2}{2} \label{eq:FlujoBurgers}
			\end{gather}

		\subsubsection{Características en la ecuación de Burgers}

			\begin{figure}[hbtp]
				\centering
				\inputtikz{CaracteristicasBurger}
				\caption{Características en la ecuación de Burguers}
				\label{fig:CaracteristicasBurger}
			\end{figure}

			Como siempre, tomamos la solución constante \[ W(x(t),t) = k \] y, derivando,
			\[ W_t + W_x x' = 0 \Rightarrow x' = W = k \]

			Por lo que las características serán: \[ x-kt = x_0, \quad \text{ con }F(x_0) = k \] y con $W(x,0) = F(x)$ nuestro dato inicial.



		\newpage % FIXME

		\begin{example}[Zona central de atasco] $ $ % hack

			Vamos a estudiar un flujo de tráfico algo más complicado: coches que vienen rápido, se paran y luego siguen un poco más lento. Nuestro sistema es el siguiente:

			\begin{minipage}{\textwidth}
				\begin{wrapfigure}[8]{R}{0.4\textwidth}
					\centering
					\inputtikz{FTresVelocidades}
					\caption{Dato inicial de velocidad para este atasco.}
					\label{fig:FTresVelocidades}
				\end{wrapfigure}

				\[
					\begin{cases}
						u_t + u u_x = 0 \\
						u(x,0) = F(x)
					\end{cases}
				\]

				Nuestro dato inicial $F(x)$ estará definido como en la \fref{fig:FTresVelocidades}: \[
					F(x) = \begin{cases}
						2 & x ∈ [-2, 0) \\
						0 & x ∈ [0, 1) \\
						1 & x ∈ [1, 2)
					\end{cases}
				\]
			\end{minipage}

			$ $ % hack: fuerza linea en blanco para evitar que el párrafo se empotre contra la imagen

			Vemos que los que vengan de la izquierda con velocidad 2 se encontrarán con la zona de velocidad 0 en la que tendrán que parar, con lo que surgirá una onda de choque entre esas dos secciones. A su vez, entre la parte de velocidad 0 y la parte de velocidad 1 surgirá una onda de rarefacción ya que la parte con más velocidad ``huirá'' de la anterior. Esto ocurre para tiempos pequeños pero habrá que ver como evoluciona el sistema.

			Las características son:
			\[ x - kt = x_0 \text{ con } F(x_0) = k \]

			Va a ocurrir en algún punto que la onda de choque llegue hasta la zona delimitada por la onda de rarefacción. La onda de choque depende de los valores a ambos lados de ésta. Cuando ocurra este suceso la onda de choque estará definida por otra ecuación. Y si en algún momento llega a confluir con la primera característica de la sección de velocidad 1 obtendrá otra forma.


			Empecemos por \textbf{tiempos pequeños}. La onda de choque que parte de $x=0$ estará definida por la ecuación de Rankine-Hugoniot \eqref{eq:DerivadaOndaChoque}:
			\[ s_1' = \frac{\text{salto q}}{\text{salto u}} = \frac{\text{salto }\frac{u^2}{2}}{\text{salto }u} = \frac{\frac{4}{2} - 0}{2-0} = 1 \]

			Esa será la derivada de nuestra onda de choque, que al ser constante es la pendiente. La onda será:
			\[ s_1(t) = t \]

			Por otra parte, necesitamos calcular la onda de rarefacción del salto entre la zona de coches parados y la de coches que se mueven con velocidad $1$. Para eso  usamos el truco de tomar las aproximaciones por $F_ε$ continuas, y nos sale lo siguiente
			\begin{gather*}
			x-k_\epsilon t = x_\epsilon \\
			u_\epsilon (x,t) = k_\epsilon = F_\epsilon (x_\epsilon) \\
			x_\epsilon \convs[][ε][0] 1 \Rightarrow x - kt = 1
			\end{gather*}

			Con lo que obtenemos la onda de rarefación desde $x=1$, que será la zona gris en la \fref{fig:ModeloTresVelocidades}.
			\[ \frac{x-1}{t} = k = u(x,t) \]

			Con esto hemos obtenido qué pasa hasta $t = 1$. La onda de choque la hemos calculado con el salto, pero teníamos datos del lado derecho. Ahora la condición de salto cambia dependiendo del punto ya que dependerá del valor de la onda de rarefacción en ese punto.

			Fijémonos en el instante \textbf{t = 1}. Tenemos una nueva onda de choque $s_2$ que parte del punto ${(x=1, t=1)}$. El flujo, que podemos calcular según la ecuación \eqref{eq:FlujoBurgers}, será $q(u) = \frac{u^2}{2}$.

			Con esto ya podemos calcular los saltos:
			\begin{align*}
			u^{-} &= 2			 & u^{+} &= \frac{s_2-1}{t} \\
			q^{-} &= \frac{4}{2} & q^{+} &= \frac{(\frac{s_2-1}{t})^2}{2}
			\end{align*}

			Ahora usando de nuevo la ecuación de Rankine-Hugoniot, sacamos la ecuación de la segunda onda de choque:
			\[  s'_2 = \frac{\frac{1}{2}[4 - (\frac{s_2 - 1}{t})^2 ]}{2-(\frac{s_2 - 1}{t})} = \frac{\frac{1}{2}(2 + (\frac{s_2 - 1}{t}))}{1} = 1 + \frac{s_2}{2t} - \frac{1}{2t} \] con un dato inicial (el punto de partida de la onda) dado por \[
			s_2(1) = 1 \]

			Esto nos lleva a una ecuación diferencial de primer orden lineal \[ s_2' - \frac{s_2}{2t} = 1 - \frac{1}{2t} \] que podemos resolver multiplicando por un factor integrante: \[ \rho s_2' - \frac{\rho}{2t} s_2 = \rho · \left(1 - \frac{1}{2t}\right) \] esperando que el lado izquierdo sea $(ρs_2)'$ para poder resolverlo fácilmente.

			Continuamos resolviendo para comprobarlo. Primero sacamos el factor integrante: \[ \rho' = \frac{-\rho}{2t} \implies … \implies \rho(t) = \frac{1}{\sqrt{t}} \]

			Ahora calculamos la derivada de $(ρs_2)'$: \
			\[ \left(\frac{s_2}{\sqrt{t}}\right)' = \frac{1}{\sqrt{t}} \left( 1 - \frac{1}{2t}\right) = t^{-1/2} - \frac{1}{2} t^{-3/2} \]
			Integramos y operamos
			$$\frac{s_2}{\sqrt{t}} = \frac{t^{1/2}}{1/2} - \frac{1}{2} \frac{t^{-1/2}}{-1/2} = 2t^{1/2} + t^{-1/2} + C$$
			$$ s_2 = 2t + 1 + C \sqrt{t} $$
			$$ s(1) = 1 \implies C = -2 $$
			$$ x = s_2 (t) = 1 + 2t - 2 \sqrt{t} $$

			Y ahora pasamos a calcular $s_3$, la curva de choque al pasar la curva a tocar la zona roja. La curva de choque habrá atravesado completamente la zona de rarefacción y podremos calcularla por el salto otra vez al tener información de las características de la zonas iniciales $x>1$.


			Comenzamos igualando $s_2$ y aplicando el punto de corte con las características $x-1=t$:
			$$ 1+2t - 2 \sqrt{t} = 1 + t \implies t- 2 \sqrt{t} = 0$$
			Como $t\neq 0$, la solución debe ser $t=4$, luego tenemos que $x=5$ (sustituyendo en la característica).

			Para calcular el salto tenemos
			$$u^{-} = 2 ; u^{+} = 1; q = \frac{u^2}{2} \Rightarrow q^{-} = 2, q^{+} = \frac{1}{2}$$
			Luego Rankine-Hugoniot nos dice que
			$$s'_3 = \frac{2 - \frac{1}{2}}{2 - 1} = \frac{3}{2} \implies s_3 = \frac{3}{2} t + C$$

			Sustituyendo el dato en la ecuación
			$$s_3 (t = 4) = 5$$

			Obtenemos $C = -1$, y tenemos la curva $s_3$:

			$$s_3(t) = \frac{3}{2} t - 1$$


			\begin{figure}[hbtp]
				\centering
				\inputtikz{ModeloTresVelocidades}
				\caption{Resultado final del modelo de tres velocidades}
				\label{fig:ModeloTresVelocidades}
			\end{figure}


			% 2016/02/02

			\textbf{Ejercicio para el lector:} calcular los valores de
			$$ u(\frac{1}{2},t) $$
			$$ u(2,t)$$
			$$ u(6,t)$$


		\end{example}

		\newpage % FIXME
		\obs Con los siguientes datos

		$$u^{-} = 0, u^+ = 1$$
		$$q^{-} = 0, q^+ = \frac{1}{2}$$

		% http://tex.stackexchange.com/a/5770
		% http://tex.stackexchange.com/a/37288
		\begin{figure}[hbtp]
			\centering
			\begin{minipage}[t]{0.45\textwidth}
				\centering
				\inputtikz{ObsAccInf}
				\caption{Aceleración infinita: se salta de $v=0$ a $v=1$}
				\label{fig:obs-aceleracion-infinita}
			\end{minipage}\quad
			\begin{minipage}[t]{0.45\textwidth}
				\centering
				\inputtikz{ObsMuro}
				\caption{``Si no recuerdo mal, el sentido físico era coches estrellándose contra un muro. No es un caso que estemos especialmente interesados en estudiar, creo.''}
				\label{fig:obs-muro}
			\end{minipage}
		\end{figure}

		Tenemos
		\[
		\begin{rcases*}
			s'(t) = \frac{1/2}{1} = \frac{1}{2}\\
			s(0) = 1
		\end{rcases*} \rightarrow s(t) = \frac{1}{2}t + 1
		\]

		Fijándonos en entornos cercanos a $x=1$ tenemos una solución generalizada:

		$$u(x,t) =
		\begin{cases}
			0 & x < \frac{1}{2} t + 1 \\
			1 & x > \frac{1}{2} t + 1
		\end{cases}$$


		Hemos obtenido esta solución ya que se puede aplicar Rankine - Hugoniot. Pero esto ha ocurrido porque hemos rellenado la zona vacía entre las características con características paralelas a las existentes en la zona de más velocidad. Ver \fref{fig:obs-aceleracion-infinita}.

		Pero a nivel físico esto no tiene sentido ya que significaría coches acelerando instantáneamente. {\bf La condición de entropía} dice que eso no puede pasar. Por eso ese tipo de áreas se rellenen con una onda de rarefacción.

		El contrario (\fref{fig:obs-muro}), por supuesto, si que tiene más sentido físico.

		Para solucionar esta dualidad de soluciones se podría añadir un término de viscosidad, pero eso convertiría nuestro sistema en uno de segundo orden que todavía no podemos resolver.

		\newpage % FIXME

		\textbf{Ejercicio interesante}
			$$u_t + uu_x = 0$$
			$$u(x,0) = F(x) $$

			con $F(x)$ como se presenta en a \fref{fig:ejer-feb-2-F}, es decir
			\begin{figure}[hbtp]
			\begin{minipage}{0.45\textwidth}
				\centering
				\inputtikz{Ejer-feb-2-F}
				\caption{ }
				\label{fig:ejer-feb-2-F}
			\end{minipage}
			\begin{minipage}{0.45\textwidth}
				$ F(x) = \begin{cases}
					1   & x < 0\\
					1-x & 0 \leq x \leq 1\\
					0   & x < 1
				\end{cases}
				$
			\end{minipage}
			\end{figure}

			\begin{wrapfigure}{l}{0.45\textwidth}
				\vspace{-15pt}
				\inputtikz{Ejer-feb-2-XT}
				\caption{hay un choque en $(1,1)$}
				\label{fig:ejer-feb-2-XT} % p20
				\vspace{15pt}
			\end{wrapfigure}

			Sea un punto $(x,t)$ tal que $x<t<1$ tenemos que
			$$x - kt = x_0 \text{ con } F(x_0) = k $$
			$$u(x,t) = F(x_0) = k$$
			$$x_0 \in (0,1) \Rightarrow F(x_0) = 1 - x_0$$

			$ $ % hack para que la frase no se empotre contra la figura

			Tenemos que todas estas características pasan por $x = 1$, $t = 1$:
			\begin{gather*}
				x - (1-x_0) t = x_0 \\
				x-t = x_0 (1-t) \\
				x_0 = \frac{x-t}{1-t} \\
				K = F(x_0) = 1 - \frac{x-t}{1-t}
			\end{gather*}

			Todas estas características $s$ terminan colapsando en el punto $(x,t)$ y a partir de ese punto aparecerá una onda de choque. La onda de choque no tiene por qué aparecer en el instante inicial.

			Lo que vamos a ver según avanza el tiempo es que el escalón en $F(x)$ va a ir reduciéndose hasta ser completamente vertical y empezar la onda de choque. Lo que hay que hacer es pintar distintos escalones con $t$ fijos hasta encontrarlo. En la \fref{fig:ejer-feb-2-choque} se ve que aparece en $t=1$.

			\begin{figure}[hbtp]
				\centering
				\inputtikz{Ejer-feb-2-choque}
				\caption{La solución parecía buena al principio, pero degenera en un choque en $t=1$}
				\label{fig:ejer-feb-2-choque}
			\end{figure}

\clearpage % FIXME: puede crear una página en blanco en medio del documento
\section{Caso general: Problema de Cauchy}
	\label{sec:ProblemaCauchy}

	De momento hemos estudiado casos bastante específicos. De hecho, ya el planteamiento inicial (\fref{sec:PlanteamientoPrimerOrden}) era muy concreto, estudiando un problema que se podía entender como un flujo a lo largo del tiempo, con ese flujo dependiendo de la densidad. Ahora bien, como buenos matemáticos, nos interesaría encontrar un caso general para ecuaciones de primer orden.

	Lo primero es olvidarnos del ``tiempo'', y simplemente tomar dos variables genéricas $x,y$ para evitar confusiones. Así, nuestras ecuaciones serán de la forma \(
		a(x,y,u)u_x + b(x,y,u)u_y = c(x,y,u) \label{eq:PrimerOrdenGenerica}
	\)

	¿Y qué hacemos con el dato? Hasta ahora siempre lo habíamos dado a lo largo de la recta $t = 0$ (salvo en el ejemplo de la \fref{sec:CurvaDatoRara}). Sin embargo, es una condición demasiado restrictiva, así que en general tomaremos la solución del dato a lo largo de una curva genérica $(\alpha(s),\beta(s))$. Así, nuestro dato será
	\[ u(\alpha(s),\beta(s)) = \gamma(s) \]

	¿Cómo resolvemos este sistema? La idea será ``propagar'' la solución dada en la curva dato siguiendo la ecuación diferencial. En cierto modo es parecido a lo que hacíamos con las características, aunque esta vez necesitaremos más artillería matemática.

	Partiendo de que $u(x,y)$ es una solución a nuestro sistema, consideraremos su gráfica $S = \set{(x,y,z) ∈ ℝ^3 \tq z = u(x,y)}$. Esta gráfica no es más que el conjunto de nivel 0 de la aplicación \[ Φ(x,y,z) = u(x,y) - z\]

	Ahora vamos a por un truco/idea feliz: sabemos que el gradiente es perpendicular a los conjuntos de nivel, por lo que en particular $\grad Φ \perp S$. Ese gradiente es fácil de calcular: \[ \grad Φ = \left(u_x, u_y, -1\right)\]

	Y aquí es donde viene la segunda ocurrencia: darnos cuenta de que $\grad Φ$ y $(a, b, c)$ son dos vectores perpendiculares, donde $a$, $b$ y $c$ eran los coeficientes de nuestra ecuación \eqref{eq:PrimerOrdenGenerica}. La comprobación se hace con una simple cuenta, ya que simplemente volvemos a la ecuación de nuevo: \[ \pesc{(u_x, u_y, -1), (a, b, c)} = au_x + bu_y - c = 0 \]

	La conclusión es que el vector $(a(p),b(p),c(p))$ es tangente a nuestra superficie solución, con $p ∈ S$. En otras palabras, que podemos reconstruir una curva solución $\Gamma ⊂ S$ con $\Gamma' = (a,b,c)$ y
	$$\Gamma(s) = (x(0),y(0),z(0)) = (\alpha(s),\beta(s),\gamma(s))$$

	Así, podremos resolver la ecuación ordinaria obteniendo una curva de cada una de los datos iniciales. Una vez obtenidas estas curvas, si todo va bien, podremos ensamblarlas en una superficie parametrizable. Deberemos probar que esta superficie se puede escribir como una gráfica de una función, pero no nos valdrá con eso, tendremos que probar que se puede escribir como función de $x$ e $y$.

	De lo que aprendimos en EDO\footnote{jajajajaja} sabemos encontrar curvas con una tangente dada. ¿Pero podemos aplicarlo para obtener superficies?

	Antes de seguir con la formalización, lo que haremos será ver unas cuantas cuentas para entrar en situación.

	\subsection{Ejemplos y cuentas previos}

	Empecemos con un ejemplo:

	\begin{example}[Problema de Cauchy]
		Partimos del siguiente sistema:
		\begin{equation*}
			\left\{
			\begin{array}{l}
				xu_x - yu_y = u - y \\
				u(s^2,s) = s \quad (s > 0)
			\end{array}
			\right.
		\end{equation*}

		Interpretación geométrica. En cada $(x,y,z)$ el vector tangente debe ser $(\underbrace{x}_{a},\underbrace{-y}_{b},\underbrace{z-y}_{c})$

		Hallamos las \textbf{curvas solución:}
		\begin{equation*}
			\left.
			\begin{array}{rl}
				 x'(t) = x \\
				 y' = -y \\
				 z' = z-y
			\end{array}
			\right|
			\begin{array}{l}
				x = x_0 e^t \\
				y = y_0 e^{-t} \\
				z' -z = -y_0 e^{-t}
			\end{array}
		\end{equation*}

		Resolvemos usando el método del factor integrante y llegamos a \[ z = \frac{y_0}{2} e^{-t} + C e^t , \quad\text{ con } C = z_0 - \frac{y_0}{2} \] de tal forma que nuestra curva viene dada por la ecuación
		\begin{align*}
			x(t) &= x_0 e^t \\
			y(t) &= y_0 e^{-t} \\
			z(t) &= \frac{y_0}{2} e^{-t} + (z_0 - \frac{y_0}{2})e^t
		\end{align*} donde los valores iniciales vienen dados por la curva dato: \[ (x_0,y_0,z_0) = (s^2,s,s) \]

		Poniendo todo en función de $s$ y $t$, llegamos a
		\begin{align*}
		x(s,t) &= s^2 e^t \\
		y(s,t) &= se^{-t} \\
		z(s,t) &= \frac{s}{2}e^{-t} + \frac{s}{2}e^{t}
		\end{align*}
		que nos permite dar una definición para la superficie:
		\[
			\Phi(s,t) = \left(s^2e^t, se^{-t}, \frac{s}{2}(e^t + e^{-t}) \right )
		\]

		\newpage % FIXME
		Debemos comprobar si este objeto es realmente una superficie y si nos sirve, es decir, responder a las siguientes preguntas:

		\begin{itemize}[itemsep = 1pt]
			\item ¿$\Phi$ describe una superficie parametrizada?
			\item ¿Podemos despejar $z=u(x,y)$?
		\end{itemize}

		\textbf{Comenzamos a despejar}, porque tenemos suerte y se puede hacer explícitamente:

		$$xy = s^3; s=(xy)^{1/3}$$
		$$e^t = \frac{x}{s^2} = \frac{x}{(xy)^{2/3}} = \frac{x^{1/3}}{y^{2/3}}$$
		$$e^{-t} = \frac{y^{2/3}}{x^{1/3}}$$

		$$z = \frac{s}{2}(e^{t}+e^{-t}) = \frac{(xy)^{1/3}}{2} (\frac{x^{1/3}}{y^{2/3}}+\frac{y^{2/3}}{x^{1/3}}) = … = u(x,y) $$


		Puede haber problemas si $x=0$ o $y=0$, pero como nuestra curva dato es
		$$(s^2,s,s), \quad s > 0$$
		en un entorno de la misma tenemos perfectamente definida la solución.

		Como veremos más adelante, esta condición de compatibilidad nos la da el rango de la matriz Jacobiana de $\Phi$.

		\begin{figure}[hbtp]
			\centering
			\inputtikz{CurvaDatoProblemaCauchy}
			\caption{En un entorno del 0 tenemos problemas.}
			\label{fig:curva-dato-ProblemaCauchy}
		\end{figure}

	\end{example}

	\begin{example}[2]

		\begin{equation*}
			\begin{cases}
				yu_x - x u_y = 0 \\
				u(\alpha(s),\beta(s)) = \gamma(s) \\
				\text{Curva dato: } \Gamma \equiv (\alpha, \beta, \gamma)
			\end{cases}
		\end{equation*}

		De este sistema obtenemos un \concept{Sistema\IS característico}:
		\begin{equation*}
			\begin{cases}
				\frac{\dif x}{\dif t} = y \\
				\frac{\dif y}{\dif t} = -x \\
				\frac{\dif z}{\dif t} = 0
			\end{cases}
		\end{equation*}

		cuyas soluciones será las \concept[Curvas\IS características]{curvas características}:
		$(x(t),y(t),z(y))$; pero a veces solo nos interesarán sus {\bf proyecciones sobre el plano XY}: $(x(t),y(t))$.

		Para resolver \underline{este sistema concreto} y llegar a las soluciones explícitas (en función de $\alpha$, $\beta$ y $\gamma$), tenemos dos formas de hacerlo.
		La primera, requiere de bastantes cálculos utilizando el método de la exponencial de la matriz para resolver el sistema de EDOs:
		\[ \begin{pmatrix}
			x \\
			y
			\end{pmatrix} =
		\begin{pmatrix}
			 0 & 1 \\
			-1 & 0 \\
			\end{pmatrix}
			\begin{pmatrix}
			x \\
			y
			\end{pmatrix}\]

		Pero podemos utilizar el siguiente atajo observando que
		\begin{gather*}
			\dpd{^2 x}{t} = \dpd{y}{t} = -x \iff \dpd{^2 x}{t} + x = 0\\
			x = A \cos t + B \sin t\\
			y = \dpd{x}{t} = -A \sin t + B \cos t
		\end{gather*}
		Por tanto, utilizando que
		\begin{gather*}
			x(0) =\alpha(s)	\implies A = \alpha(s)\\
			y(0) = \beta(s) \implies B = \beta(s)
		\end{gather*}
		entonces
		$$x(t,s) = \alpha(s) \cos t + \beta (s) \sin t$$
		$$y(t,s) = -\alpha(s) \sin t + \beta (s) \cos t$$
		$$z(t,s) = \gamma(s)$$

		Combinando todas esas curvas características podremos ensamblar la superficie que buscamos. Ahora observemos los resultados con valores concretos de $\alpha$, $\beta$ y $\gamma$:

		$$(\alpha(s), \beta(s), \gamma(s)) = (s,s,s^2), \quad s>0$$
		$$\Phi(s,t) = (\underbrace{s(\cos t + \sin t)}_{x}, \underbrace{s(\cos t - \sin t)}_{y},s^2)$$

		$$x^2 + y^2 = s^2 (\cos^2 t + 2 \sin t \cos t + \sin^2 t) + s^2 (\cos^2 t - 2 \sin t \cos t + \sin^2 t) = 2s^2$$

		Si calculamos la proyección en el plano $(x,y)$ de las características lo que aparecen son circunferencias centradas en el origen. Pero eso nos plantea un problema. Si tenemos un dato inicial simple no tenemos problema, pero qué pasa si suponemos:
		$$\Gamma = (s, 0, \gamma(s))$$
		A lo largo de la característica la solución debería permanecer constante\footnote{recordemos que era un problema homogéneo
		} pero en este caso no pasaría si $\gamma(-s) \neq \gamma(s)$. Luego no podemos obtener soluciones globales y debemos conformarnos con soluciones locales.


	\end{example}

	\begin{example}{\bf 3}

		Resolvamos una \concept{Ecuación\IS de Burgers}
		\[
			\left\{
			\begin{array}{l}
				uu_x + u_y = 0 \\
				u(x,0) = F(x)
			\end{array}
			\right.
		\]

		\textbf{Sistema característico:}
		\[
			\left\{
			\begin{array}{l}
				\frac{\dif x}{\dif t} = z \\
				\frac{\dif y}{\dif t} = 1 \rightarrow y = t \\
				\frac{\dif z}{\dif t} = 0 \rightarrow z = F(s) \\
			\end{array}
			\right.
		\]

		$$(x,y,z) |_{t=0} = (s,0,F(s))$$
		Siendo un poco parcos en palabras, presentamos la solución:
		\[
			\left.
			\dpd{x}{t} = F(s) \rightarrow \\
			\begin{array}{l}
				x = F(s)t + C \\
				x |_{t=0} = s
			\end{array}
			\right\} \rightarrow C = s
		\]

		\textbf{Superficie solución:}
		$$\Phi(s,t) = (F(s) t + s, t , F(s))$$
		Si intentamos despejar
		$$x - F(s)t = s \implies x-F(s)y = s$$
		¿Cómo despejamos $s = s(x,y)$?

		\noindent¿Seremos capaces de encontrar $z = F(s(x,y)) = u(x,y)$?

		\noindent {\bf ¿Dónde se esconden los choques y las ondas de rarefacción?}

		\noindent¿Es posible que la solución dependa del método? Recordemos que aunque el dato sea $C^\infty$ pueden aparecer ondas de choque. La respuesta a todas estas preguntas es que estamos utilizando un teorema de existencia y unicidad de \underline{soluciones locales}.

		\noindent Por tanto, tenemos por delante un viaje en busca de los monstruos: soluciones no regulares... y los tremendos: ¿qué hacemos cuando la curva característica coincide con el dato?

	\end{example}


	Esto que hemos estado viendo se puede encontrar en \cite{salsaPDE} en el Capítulo 4.
% Lo que estamos viendo se puede encontrar en S. Salsa Partial Differential Equations in Action (Cap. 4)

% Clase 8/2/16.

\clearpage % FIXME: puede crear una página en blanco en medio del documento
\subsection{Formalización}

Vamos a tratar de formalizar lo que hemos visto hasta ahora. Tenemos una ecuación a resolver \[ a(x,y,u) u_x + b(x,y,u) u_y = c(x,y,u)\] con un dato \[ u(α(s), β(s)) = γ(s)\quad s∈[a,b]\] con $a,b,c,α,β,γ ∈ C^1$. El dato se puede tomar como dado a lo largo de una curva $Γ(s) = (α(s), β(s), γ(s))$ que ha de tener unas ciertas restricciones, principalmente que para cada valor de $x,y$ tenemos que tener un único valor de $z$ (no nos valen rectas verticales ni espirales, por ejemplo).

El método de resolución es el \concept{Método\IS de las características}. El primer paso es resolver el sistema característico en $t$ dado por
\begin{align*}
	\dpd{x}{t} &= a(x,y,z) \\
	\dpd{y}{t} &= b(x,y,z) \\
	\dpd{z}{t} &= c(x,y,z) \\
	\left. (x,y,z) \right|_{t=0} &= (α(s), β(s), γ(s))
\end{align*}

Este es un sistema de Ecuaciones diferenciales ordinarias, que sólo necesita que las funciones sean Lipschitz localmente. Esta condición viene gratis por ser $a,b,c ∈ C^1$, así que tenemos existencia y unicidad locales del sistema característico.

El siguiente paso es considerar la aplicación \[ Φ(s,t) = (x(s,t), y(s,t), z(s,t))\] con las funciones que hemos obtenido previamente resolviendo el sistema característico. La pregunta es si Φ es una \concept[Parametrización]{parametrización} y por lo tanto describe una superficie. Para ello necesitamos que la diferencial $\Dif Φ$ tenga rango 2 y sea un homeomorfismo sobre su imagen.

Dado que cuando nos alejamos del punto inicial tenemos monstruos, lo que buscaremos es que las dos condiciones se cumplan sólo para $t$ pequeño. Esto nos permite no tener que verificar la condición de homeomorfismo sobre su imagen, ya que se cumple directamente para $t$ pequeño por la estructura de la curva dato Γ, que no tiene autointersecciones.

Estudiamos ahora la diferencial de Φ para ver qué ocurre con la condición del rango: \[ \Dif Φ = \begin{pmatrix} \dpd{x}{s} & \dpd{y}{s} & \dpd{z}{s} \\ & & \\ \dpd{x}{t} & \dpd{y}{t} & \dpd{z}{t} \end{pmatrix} \]

Por continuidad, nos bastará ver que tiene rango máximo para $t = 0$, ya que nos dará directamente rango máximo en un entorno pequeño de $t$. Pero teniendo en cuenta el sistema característico, podemos simplificar y tenemos que \[ \eval[2]{\Dif Φ}_{t=0} = \begin{pmatrix}
α' & β' & γ'  \\
a(α, β, γ) & b(α,β,γ) & c(α,β,γ) \end{pmatrix}
 \] por lo que podemos evaluar el rango sin tener que resolver el sistema, ya que la diferencial sólo depende de los coeficientes y de la curva dato.

Una vez que sabemos que Φ define una superficie, necesitaremos despejar ${z = u(x,y)}$. Para eso necesitaremos el teorema de la función implícita \citep[Teorema II.5]{ApuntesAnalisisMat}, aunque en realidad sólo nos hace falta el teorema de la función inversa. Entonces, sólo tenemos que pedir que el determinante \( \left|\begin{matrix} a & b \\ α' & β' \end{matrix}\right| \label{eq:CondTransversalidad} \) sea distinto de $0$. Es decir, que sólo comprobando esta \concept{Condición\IS de transversalidad} podremos resolver el paso 2 (garantiza que Φ define una superficie) y el paso 3 (podemos despejar $z = u(x,y)$).

\begin{theorem} \label{thm:Transversalidad} Supongamos que $a,b,c,α,β,γ ∈ C^1$.

\noindent Si se verifica la condición de transversalidad \eqref{eq:CondTransversalidad} en todos los puntos de la curva dato, el problema tiene una solución $z = u(x,y)$ definida en \textbf{un entorno local} de cada punto, que se puede construir con las curvas características.
\end{theorem}

Sin embargo, esto no nos resuelve todos los problemas. Tenemos unicidad a través de este método, pero no sabemos si otro método nos puede dar otra solución distinta. Además, no sabemos qué pasa cuando la condición de transversalidad se estropea: ¿qué tipo de desastres aparecen?

\subsubsection{Cuando la condición de transversalidad no se cumple}
\label{sec:CondTransversalidadInvalida}

Suponemos que $s_0$ es un punto característico o singular, donde el determinante de \eqref{eq:CondTransversalidad} es cero. Aun así, podemos suponer que existe una solución $u ∈ C^1$ en un entorno de $Γ(s_0)$.

Si el determinante es $0$, entonces $aβ' - α'b = 0$, así que tenemos que \begin{align*}
aα'u_x + bα'u_y &= cα' \\
aα'u_x + bα'u_y &= aγ'
\end{align*} y por lo tanto $cα' = aγ'$, lo que nos lleva a que \[ \frac{a}{α'} = \frac{b}{β'} = \frac{c}{γ'} \]

Si aun así tenemos solución, la única posibilidad que nos queda para tener solución $C^1$ es que el rango de la matriz $\Dif Φ$ sea $1$. Alternativamente, si el rango de $\Dif Φ$ es 2, no existe ninguna solución $u ∈ C^1$ en un entorno del punto característico.

\subsubsection{¿Existen otras soluciones?}

\begin{figure}[hbtp]
\centering
\inputtikz{SolucionAlternativaCaracteristica}
\caption{Esquema de cómo resolver la situación cuando hay una solución alternativa (verde) a la definida por las curvas características (naranja).}
\label{fig:SolucionesAlternativasCaracteristica}
\end{figure}

Vamos a demostrar que cualquier posible solución que coincida con un punto en la característica, entonces coincide completamente con la característica. Definiremos \[ D(t) = z(t) - u(x(t), y(t))\] donde $u$ es nuestra solución alternativa y $z$ la curva característica. Su derivada será \[ D'(t) = z'(t) - u_x(x(t), y(t)) x'(t) - u_y(x(t), y(t)) y'(t)\] que haciendo cuentas tendremos que \begin{align*} D'(t) &= c(x, y, D(t) + u(x,y)) - u_x(x,y) \cdot a(x,y, D+u(x,y)) - u_y \cdot b(x,y, D + u(x,y)) \\
&= F(t, D(t))
\end{align*} simplificando un poco en el último paso, y sabiendo que $D(0) = 0$. En ese caso, volvemos a tener la expresión de la solución, así que el sistema \[ \begin{cases} D'= F(t,D) & \\ D(0) = 0 & \end{cases} \] tiene una solución única $D \equiv 0$ por el teorema de existencia y unicidad, luego $u$ contiene a la característica.


\subsubsection{Toda la curva dato es característica}

Antes (\fref{sec:CondTransversalidadInvalida}) hemos visto qué ocurre cuando la condición de transversalidad no se cumplía, pero sólo hemos tenido en cuenta el caso de un punto característico aislado. ¿Qué pasa si, por ejemplo, tenemos toda la curva dato con puntos característicos?

Podemos hacer un experimento mental: cogemos una curva transversal a la curva anterior (en la proyección) y que interseque con ella; y planteamos el mismo problema que antes pero con esta nueva curva dato. Ya que lo elegimos, nuestra curva hará que el determinante siempre sea distinto de 0, y tendremos una solución al nuevo sistema que también será válida para el sistema anterior, ya que la curva dato anterior será una característica de este nuevo sistema\footnote{\noteby{Guille}{No estoy 100\% seguro de esto.}}. La cuestión es que hay infinitas formas de coger esa nueva curva dato, así que tenemos infinitas posibles soluciones.

La conclusión de todo esto es que el problema no estaría bien propuesto porque sus soluciones no tendrían mucho sentido.

\subsection{Más ejemplos}

	\begin{example}[1]
		\[\left\{ \begin{array}{l} uu_x + u_y = 0 \\ u(x,0) = F(x) \end{array}\right.\]

		\[ \left.\begin{array}{r}
		a(x,y,z) = z \\
		b(x,y,z) = 1 \\
		c(x,y,z) = 0 \\
		\end{array} \right| \begin{array}{l}
		\alpha(s) = s \\
		\beta(s) = 0 \\
		\gamma(s) = F(s) \end{array}
		(x,y,z)|_{t=0} = (s,0,F(s))
		\]

		\textbf{Condición de transversalidad}

		\[\det \left.\begin{pmatrix}
		a & b \\
		\alpha' & \beta'
		\end{pmatrix} \right|_{t=0}  = \det \left. \begin{pmatrix}
		F(s) & 1 \\
		1 & 0
		\end{pmatrix} \right|_{t=0} = -1 \neq 0\]

		Por lo tanto tenemos existencia y unicidad de la solución. Vamos a calcularla:

		\textbf{Resolución del sistema característico}

		\[ (x,y,z) |_{t=0} = (s,0,F(s)) \]
		\begin{align*}
		\dpd{x}{t} &= z \\
		\dpd{y}{t} &= 1 \rightarrow y = t \\
		\dpd{z}{t} &= 0 \rightarrow z = F(s) \rightarrow x = F(s)\cdot t + s
		\end{align*}


		\textbf{Solución}
		\[\Phi(t,s) = (F(s)t+s, t, F(s))\]

		{\bf Proyección del dato y las características en el plano XY:}

		\begin{figure}[hbtp]
			\inputtikz{Ejemplo-02-09-proyXY}
			\caption{La pendiente de la característica azul dependerá de la $F$}
			\label{fig:Ejemplo-02-09-proyXY}
		\end{figure}

		\[
		\left.
		\begin{array}{r}
		x = F(s)t + s \\
		y = t
		\end{array}
		\right\} \quad x - F(s)\cdot y = s \iff x - ky = s \ \text{ con } \ k = F(s)
		\]
		Con esto vemos que la pendiente de las curvas características depende de la $F$. Esto hace que tengamos 2 casos
		\begin{itemize}
			\item Si la F es contínua, los choques se postergan.
			\item Si la F es discontínua, aparecen directamente.
		\end{itemize}


	\end{example}

	\textbf{Problema propuesto a continuación de lo anterior}

	Consideramos esta $F(s)$ que se muestra en la \fref{fig:Ejemplo-02-09-suave}:

	\[
	F(s) =
	\begin{cases}
	1 & s < 0 \\
	\cos^2 s & 0 \leq s \leq \frac{\pi}{2} \\
	0 & s > \frac{\pi}{2}
	\end{cases}
	\]

	aquí vamos a ver cómo los problemas empiezan cuando se forme una discontinuidad por culpa del avance de las características a diferencia de los ejemplos anteriores en los que ya había una discontinuidad en el dato inicial.

	\begin{figure}[hbtp]
		\centering
		\inputtikz{Ejemplo-02-09-suave}
		\caption{La $F$ propuesta. Nos valdría cualquier $F$ que se pudiese escribir como función de $x$ y que no se ponga vertical.}
		\label{fig:Ejemplo-02-09-suave}
	\end{figure}

	\begin{example}{\bf 2}

		\noindent Sea el problema:
		\[
		\begin{array}{l}
			u u_x + u_y = 1 \\
			u(x,0) = F(x)
		\end{array}
		\]

		Como es fácil comprobar que se cumple la condición de transversalidad, vamos a dar la superficie solución directamente:
		\[ \Phi(s,t) = (\frac{t^2}{2} + F(s) t + s, t, F(s) + t) \] proyectándolas después en XY: \[ x - F(s)y - \frac{y^2}{2} = s \] observamos que tenemos unas parábolas en y.

		Se deja como ejercicio para el diligente lector dibujar las características y compararlas con el ejemplo anterior.

	\end{example}

	\begin{example}{\bf3: ej8 hoja 1}

		Dado el problema
		\[(y+u)u_x + y u_y = x-y \]
		\[u(x,1) = 1 + x \]

		Vamos a darle a la maquinaria:

		\[ \left. \begin{array}{r}
		a(x,y,z) = y+z \\
		b(x,y,z) = y \\
		c(x,y,z) = x-y
		\end{array} \right| \begin{array}{l}
		\alpha(s) = s \\
		\beta(s) = 1 \\
		\gamma(s) = 1+s \end{array}
		(x,y,z)|_{t=0} = (s,1,1+s)
		\]

		Comprobamos la {\bf condición de transversalidad}:

		\[ \det \left.\begin{pmatrix}
		a  & b \\
		\alpha' & \beta' \end{pmatrix}\right|_{t=0} =
		\det \left.\begin{pmatrix}
		y+z  & y \\
		1 & 0 \end{pmatrix} \right|_{t=0} =
		\det \left.\begin{pmatrix}
		2+s  & 1 \\
		1 & 0 \end{pmatrix} \right|_{t=0} = -1 \neq 0 \]

		Por lo tanto se cumple la condición: tenemos existencia y unicidad de una solución $C^1$ local. Pasamos a resolver {\bf el sistema característico}:

		\begin{align*}
			 \dpd{x}{t} &= y+z  \\
			 \dpd{y}{t} &= y \\
			 \dpd{z}{t} &= x-y
		\end{align*}
		$$(x,y,z)|_{t=0} = (s,1,1+s)$$

		Llegados a este punto, podemos ver el sistema como en EDO:
		$$
		\begin{pmatrix}
			x \\
			y \\
			z
		\end{pmatrix}
		=
		\begin{pmatrix}
			0 & 1 & 1 \\
			0 & 1 & 0 \\
			1 & -1 & 0
		\end{pmatrix}
			\cdot
		\begin{pmatrix}
			x \\
			y \\
			z
		\end{pmatrix}
		$$
		Y aplicar el método de exponencial de una matriz. Pero en este caso, podemos resolverlo a mano:

		Si observamos la segunda ecuación y el dato, tenemos que $ y = e^t $.

% en la igualdad de las derivadas parciales, la segunda derivada de x es igual a la derivada de z + e^t y ahora mismo pone que es la segunda derivada de x es igual a la derivada de z

		Sustituyendo en el sistema:
		\[
		\begin{rcases*}
			 \dpd{x}{t} = e^t + z  \\
			 \dpd{z}{t} = x - e^t
		\end{rcases*}
		\rightarrow \dpd{^2 x}{^2 t} = e^t + \dpd{z}{t} = e^t + x - e^t = x
		\]
		Luego
		$$\dpd{^2 x}{^2 t} = x \rightarrow x = A \cdot e^t + B \cdot e^{-t}$$
		Finalmente, despejamos z en la ecuación de $\dpd{x}{t}$ y sustituimos:
		$$z = \dpd{x}{t} - e^t = (A \cdot e^t - B \cdot e^{-t}) - e^t = (A-1)e^t - B e^{-t}$$

		Aplicando el dato, obtenemos que $A=1+s$, $B=-1$; luego la solución queda así:

		\[ \Phi(s,t) = (\underbrace{(1+s)e^t-e^{-t}}_{x},\underbrace{e^t}_{y}, s\cdot e^t + e^{-t}) \]

		En este caso, además se puede despejar:

		\[  \left. \begin{array}{r}
		s = s(x,y) \\
		t = t(x,y)
		\end{array}
		\right\}\rightarrow \dots \rightarrow z = x + \frac{2}{y} - y \equiv u(x,y)
		\]

		Gracias a esto, podemos ver que la solución tiene un problema en un entorno de ${y = 0}$.

		\noindent {\bf ¿Habríamos podido verlo si no hubiésemos sabido despejar?} Probablemente.

		Hagamos la proyección de las características en el plano $XY$:

		\[
		\left.
		\begin{array}{l}
			x = (1+s)e^t - e^{-t} \\
			y = e^{t}
		\end{array}
		\right\}
		\Rightarrow x = (1+s) y - \frac{1}{y}
		\]

		\[ y = 1 \Rightarrow x = s \] Por encima de la recta $y=1$ tenemos curvas que son casi rectas, y por debajo hipérbolas.

		Usando como dato: \[ (x,y) |_{t=0} = (s,1) \]

		\begin{figure}[hbtp]
			\inputtikz{Ejemplo-3-feb-09-proy-XY}
			\caption{No tenemos datos para ver qué pasa en el semiplano inferior.}
			\label{fig:Ejemplo-3-feb-09-proy-XY}
		\end{figure}

		En el dibujo podemos ver cómo, a pesar de nuestras preocupaciones, las características nos indican que las soluciones que pasan por nuestro dato \underline{no pasan} por $y=0$.

	\end{example}


	Planteamos otro problema:
	\begin{example}{\bf 4: ej 10 hoja 1}

		\[
		\begin{rcases*}
			u^2u_x + u_y = 0, & x > 0 \\
			u(x,0) = \sqrt{x}
		\end{rcases*}
		 \]

		A falta de comprobación de las cuentas, la solución será \[u(x,y) = \sqrt{\frac{x}{y+1}} \]

		Hay que ver que la proyección de las características en el plano $XY$ y ver que son rectas que se cortan en el punto $(0,-1)$.

	\end{example}

	\begin{example}{\bf 5: ej 4 hoja 1}
		Vamos a hacer un pequeño comentario sobre este ejercicio:

		\[ V(\rho) =
		\left.
		\begin{array}{l}
			… \\
			… \\
			…
		\end{array}
		\right\} \Rightarrow \text{Flujo } q = v \cdot \rho
		\]
		\obs en este problema la velocidad es de las partículas, {\bf NO} la densidad.

		$$\rho_t + (q)_x = 0 \iff \rho_t + (v(\rho) \cdot \rho)_x = 0$$
		Aquí habría que hacer lo que los ingenieros llaman análisis dimensional de los datos:

		\begin{gather*}
		[y] = \frac{\text{\# coches}}{\text{tiempo}}\\
		[\rho] = \frac{\text{\# coches}}{\text{longitud}}\\
		[v] = \frac{\text{longitud}}{\text{tiempo}}
		\end{gather*}

		% algo más que añadir?


	\end{example}

	\begin{example}{\bf 6}

		Vamos a resolver otro ejemplo:
		\[
		\left\{
		\begin{array}{l}
			xu_x+ yu_y = -u\\
			u(\cos s, \sin s) = 1,\quad 0 \leq s \leq R
		\end{array}
		\right.
		\]

		\[ \left. \begin{array}{r}
		a(x,y,z) = x \\
		b(x,y,z) = y \\
		c(x,y,z) = -z
		\end{array} \right| \begin{array}{l}
		\alpha(s) = \cos s \\
		\beta(s) = \sin s \\
		\gamma(s) = 1 \end{array}
		\quad(x,y,z)|_{t=0} = (\cos s,\sin s,1)
		\]

		{\bf Condición de transversalidad:}

		\[\det \left. \begin{pmatrix}
			a & b \\
			\alpha' & \beta'
		\end{pmatrix} \right|_{t=0} =
		\det \left. \begin{pmatrix}
			a(\alpha(s), \beta(s), \gamma(s)) & b(\alpha(s), \beta(s), \gamma(s)) \\
			\alpha' & \beta'
		\end{pmatrix} \right|_{t=0} = \det \begin{pmatrix}
			\cos s & \sin s \\
			-\sin s & \cos s
		\end{pmatrix} = 1 \neq 0 \quad \forall s \]
		luego tenemos existencia y unicidad de una solución local $C^1$.

		Resolvamos el {\bf sistema característico}, que en este caso es extremadamente sencillo:
		\begin{align*}
			 \dpd{x}{t} &= x \rightarrow x(x,t) = \cos(s) e^t\\
			 \dpd{y}{t} &= y \rightarrow y(s,t) = \sin(s) e^t\\
			 \dpd{z}{t} &= -z \rightarrow z(s,t) = e^{-t}\\
			(x,y,z)|_{t=0} &= (\cos s,\sin s,1)
		\end{align*}
		Luego la {\bf superficie solución} es:
		\[\Phi(s,t) = (\cos(s) e^{t}, \sin(s) e^t, e^{-t})\]

		En este caso se alinean los astros, y podemos despejar explícitamente:

		Como
		\[
		\begin{rcases}
			x = \cos (s) e^t\\
			y = \sin (s) e^t
		\end{rcases}
		 \longrightarrow x^2 + y^2 = e^{2t} \]
		luego
		\[e^t = \sqrt{x^2 + y^2} \implies z = e^{-t} = \frac{1}{\sqrt{x^2 + y^2}} \]

		Por lo que la solución es:
		\[ u(x,y) = \frac{1}{\sqrt{x^2+y^2}}\]

		que tiene problemas en el $(0,0)$. Así que veamos su {\bf proyección en XY de dato y características}:

		\[
		\begin{rcases}
			x = \cos (s) e^t\\
			y = \sin (s) e^t
		\end{rcases}
		\implies y/x = \tan(s) \]

		Las soluciones son ${y = x \tan(s)}$, que son rectas que pasan por el $(0,0)$ con pendiente $\tan(s)$, como se puede apreciar en la \fref{fig:Proy-XY-ejemplo-6}.

		\begin{figure}[hbtp]
			\inputtikz{Proy-XY-ejemplo-6}
			\caption{Algunos ejemplos de características (azul) y del dato (colorado).}
			\label{fig:Proy-XY-ejemplo-6}
		\end{figure}

	\end{example}

	\begin{example}{\bf 7}

		Vamos a resolver otro ejemplo:
		\[
		\begin{cases}
			uu_x+ u_y = 1\\
			u(\frac{s^2}{4}, s) = \frac{s}{2}
		\end{cases}
		\]

		\begin{gather*}
			\left. \begin{array}{r}
			a(x,y,z) = z \quad\\
			b(x,y,z) = 1 \quad\\
			c(x,y,z) = 1 \quad
			\end{array} \right| \begin{array}{l}
			\alpha(s) = \frac{s^2}{4} \\
			\beta(s) = s \\
			\gamma(s) = \frac{s}{2} \end{array}\\
			(x,y,z)|_{t=0} = (\frac{s^2}{2}, s, \frac{s}{2})
		\end{gather*}


		Comprobamos la {\bf condición de transversalidad}:
		\[\det \left. \begin{pmatrix}
			a & b \\
			\alpha' & \beta'
		\end{pmatrix}\right|_{t=0} =
		\det \begin{pmatrix}
			\frac{s}{2} & 1 \\
			\frac{s}{2} & 1
		\end{pmatrix} = 0 \quad \forall s \]
		Como no se cumple, vamos a ver si podemos al menos tener solución:
		\[ \text{Rango}
		\left. \begin{pmatrix}
			a & b & c \\
			\alpha' & \beta' & \gamma'
		\end{pmatrix}
		\right|_{t=0} = \text{Rango}
		\left. \begin{pmatrix}
			\frac{s}{2} &1 & 1 \\
			\frac{s}{2} &1 & \frac{1}{2}
		\end{pmatrix} \right|_{t=0} = 2 \neq 1 \implies \not \exists \text{ solución } C^1
		\]

		Aunque sepamos que no existe solución, seguimos adelante y hacemos las cuentas, para ver qué ocurre:
		\[
		\begin{rcases}
			 \dpd{x}{t} = z  \\
			 \dpd{y}{t} = 1 \\
			 \dpd{z}{t} = 1
		\end{rcases}
		\Longrightarrow … \Longrightarrow
		\begin{cases}
			x = \frac{t^2}{2}+\frac{s}{2}t + \frac{s^2}{4} \\
			y = s+t \\
			z = \frac{s}{2}+t
		\end{cases}
		\]

		No podemos despejar la $z$, pero si podemos despejar la $x$. Esto significa que si vamos a tener superficie solución, que en la práctica no nos va a servir porque se dobla de forma que su plano tangente se pone vertical.

		Con un poco de destreza\footnote{$z^2$ es casi lo que buscamos, solo hay que conseguir sumarle $\frac{s^2}{4}$, y por suerte $y-z = \frac{s}{2}$} deberíamos obtener:
		\[
		x = \frac{1}{2} \{z^2 + (y-z)^2\}
		\]
		La superficie solución será el conjunto de nivel 0 de \[F(x,y,z)= x - \frac{1}{2} \{z^2 + (y-z)^2\} = 2x-\{z^2 + (y-z)^2\}\]

		Recordemos que el \concept[Gradiente]{gradiente} debe ser perpendicular al conjunto de nivel:
		\[\vec{n} = \nabla F = (2,-2y+2z, -4z+2y)\]

		Luego la solución de la curva dato es
		\[
		\begin{cases}
			x=\frac{s^2}{4} \\
			y = s \\
			z = \frac{s}{2}
		\end{cases}
		\implies \vec{n} = (2,-s,0)
		\]

		Este último 0 nos indica que que el vector normal es horizontal; luego el plano tangente es vertical, por lo que la derivada se hará infinito en algún punto. Luego $u(x,y) \notin C^1$.

		Además, podemos mirar {\bf las proyecciones en el plano XY}:
		\[x = \frac{1}{2} \{2z^2 + y^2 - 2yz\} = … = (\frac{y}{2} - z)^2 + \frac{y^2}{4} \geq \frac{y^2}{4}\]

		\begin{figure}[hbtp]
			\begin{minipage}[t]{0.45\textwidth}
				\inputtikz{Plano-tg-vertical}
				\caption{Idea: los planos tangentes a $\Phi$ en la curva dato se quedan verticales }
			\end{minipage}
			\quad %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc
			\begin{minipage}[t]{0.45\textwidth}
				\inputtikz{Ejemplo7-ProyXY}
				\caption{Hemos sombreado la región donde caen las proyecciones.}
				\label{fig:Ejemplo7-ProyXY}
			\end{minipage}
		\end{figure}

		Con esto vemos de nuevo que la función de $z$ no puede ser expresada con $x$ e $y$, por lo que no vamos a ser capaces de encontrar una solución como la que buscábamos.


	\end{example}
	\begin{example}{\bf 8}

		Vamos a mirar el mismo problema, pero con distinto dato incial:
		\[
		\left\{
		\begin{array}{l}
			uu_x+ u_y = 1\\
			u(\frac{s^2}{2}, s) = s
		\end{array}
		\right.
		\]

		{\bf Transversalidad}
		\[ \det \left. \begin{pmatrix}
			a & b\\
			\alpha' & \beta'
		\end{pmatrix} \right|_{t=0} =
		\begin{pmatrix}
			s & 1\\
			s & 1
		\end{pmatrix} =
		0\quad \forall s\]
		Luego tenemos un problema: no podemos decir si tenemos solución ni garantizar su unicidad. Vamos a ver si podemos tener al menos solución $C^1$ mirando el rango:

		{\bf Rango}
		\[
		\left. \begin{pmatrix}
			a & b & c \\
			\alpha' & \beta' & \gamma'
		\end{pmatrix}
		\right|_{t=0} = \text{Rango}
		\begin{pmatrix}
			s &1 & 1 \\
			s &1 & 1
		\end{pmatrix} = 1
		\]
		Luego no podemos garantizar que haya solución $C^1$, pero esto nos dice que si la hay, puede no ser única.

		Resolvemos el {\bf sistema característico} y obtenemos la siguiente superficie solución:
		\[
		\Phi(s,t) = (\frac{1}{2}(s+t)^2, (s+t), (s+t))
		\]
		Que con el cambio e variables adecuado vemos que
		\[ \Phi(s,t) \eqexpl[\equiv]{$s+t = \xi$} \sigma(\xi) = (\frac{\xi^2}{2}, \xi, \xi) \equiv \text{Curva dato} \]
		Luego hemos dado con un caso en el cual la solución es nuestra propia curva dato: cualquier característica es la curva dato.

		\begin{figure}[hbtp]
			\inputtikz{Ejemplo-Dato-Y-Sol-Coinciden}
			\caption{Cualquier característica que dibujemos coincide con el dato inicial.}
			\label{fig:Ejemplo-Dato-Y-Sol-Coinciden}
		\end{figure}

		Tomamos un dato alternativo que satisfaga la transversalidad. Por ejemplo $u(x,0) = Cx$. Si se resuelve para estos datos podremos hasta despejar explícitamente y llegaremos a que:

		\[ z = \frac{x-\frac{y^2}{2}}{y + \frac{1}{C}}+y
		\]

		Aquí deberíamos dibujar las proyecciones de las características y vemos que, para $C$ fijo, todas se cortan en un punto.

		\begin{figure}[hbtp]
			\inputtikz{Ejemplo8-Caract-C1}
			\caption{Ejemplo, $C=1$. Las características se cortan en $x=\frac{1}{2 C^2}$, $y = \frac{-1}{C}$}
			\label{fig:Ejemplo8-Caract-C1}
		\end{figure}

	\end{example}

	\begin{example}{\bf 9}

		Vamos a mirar este otro problema:
		\[
		\left\{
		\begin{array}{l}
			u_x+ u_y = 1 - u\\
			u(x,x+x^2) = \sin(x) \quad (x>0)
		\end{array}
		\right.
		\]

		Comprobamos la {\bf condición de transversalidad}:
		\[\det \left. \begin{pmatrix}
			a & b \\
			\alpha' & \beta'
		\end{pmatrix} \right|_{t=0} = 2s \neq 0 \text{ si } s > 0 \]

		Luego tenemos existencia y unicidad de la solución si $s\neq0$.

		Pasamos a resolver el {\bf sistema característico}\footnote{la $z$ es una EDO lineal, que se resuelve con el factor integrante $\mu = e^t$} y la solución es:
		\[
		\begin{array}{l}
		x = s+t \\
		y = s^2 + s + t \\
		z = 1 - (1 - \sin(s) )e^{-t}
		\end{array}
		\]

		\begin{wrapfigure}{l}{4cm}
			\centering
			\inputtikz{Proy-XY-Ejemplo-9}
		\end{wrapfigure}

		Para hacer la {\bf proyección en el plano XY} hay que observar que $y = s^2 + x $, luego tenemos que son rectas con pendiente 1 y ordenada en el origen $s^2$.

		Despejando obtenemos que
		\[y-x = s^2 > 0 \implies y > x\]

		En el punto 0 no estaría definida la solución pero podemos observar que pasa en la región inferior a 0 de todas formas:

		\clearpage
		Tomando $ s\in \mathbb{R} $, vemos que las características cortan a la curva en dos puntos:

		\begin{figure}[hbtp]
			\centering
			\inputtikz{Proy-XY-Ejemplo-9-todo-R}
		\end{figure}

		Buscamos saber si hay algún entorno del 0 en la región izquierda en el cual la solución esté definida.

		¿Es esto compatible con que el sistema tenga solución? Veámoslo con un ejemplo:

		\textbf{Ejemplo}
		\[g(x) = u(x,x+s^2)\]
		\[g'(x) = u_x (x,x+s^2) + u_y(x,x+s^2) = 1 - u(x,x+s^2) = 1 - g(x)\]
		\[g' = 1-g\]
		De lo que obtenemos que $(x,x+s^2) \rightarrow $ corta al dato en $x=s, x=-s$.

		Tendríamos dos datos:

		\[
		\begin{cases}
		g(s) = \sin(s) \\
		g(-s) = \sin(-s)
		\end{cases}
		\]

		Encontramos las curvas características y lo que antes era una EDP se convierte en una EDO a lo largo de la curva. Como alguna característica corta al dato en dos puntos, tenemos que comprobar si la EDO a lo largo de la curva es compatible con los dos datos a la vez. La idea es resolver la EDO con uno de los datos, y una vez resuelta y despejada la constante de integración comprobamos si es compatible con el segundo dato.

		Si la compatibilidad se cumpliera habría solución pero si no, solo se puede obtener solución en regiones aisladas. En este caso no lo vamos a comprobar pero no son compatibles.

	\end{example}

